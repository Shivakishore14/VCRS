<html>
	<head>
		<link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/bootstrap-theme.css"/>
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js" type="text/javascript"></script>
		<script src="js/bspage.js"></script>
		<script src="js/script.js"></script>
	</head>
	<body>
		<div id="top">
			<span id="logo">V.C.R.S</span>
		</div>
		<div id="test"></div>
		<div class="container-fluid">
			<div class="row">
				<div class="col-lg-3 col-md-3" id="panel">
					<br>
					<div class="panel panel-primary">
  						<!-- Default panel contents -->
 						<div class="panel-heading " id="testHead"><b>Tests Available</b></div>

						<div class="list-group" id="listTest">
  							<button type="button" class="list-group-item">Test</button>
  							<button type="button" class="list-group-item">Test2</button>
  							<button type="button" class="list-group-item">Test3</button>
  							<button type="button" class="list-group-item">Test4</button>
  							<button type="button" class="list-group-item">Chemistry</button>
						</div>
					</div>
				</div>

				<div class="col-lg-9 col-md-9">
					<h2> Test Responses</h2>
					<table class="table table-striped table-bordered" id="tresult">
					</table>
					<div id="chart_div" style="width: 100%; height: 500px;"></div>
					<button class="btn btn-success" onclick="chartViewOn()">show Chart</button>
					<div id="status">
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

	</body>
	<style>
		#panel{
			background-color:#fff;
		}
		#test{
			position: absolute;
			width: 100%;
			height: 100%;
			background-color:aqua;
		}
		#top{
			height:50px;
			background-color:#00AE6D;
			padding-left:5%;
			color: #fff;
			font-size: 30px;
			font-weight: bold;
		}
		.table td {
			text-align: center;
		}
		.green{
			color: green;
		}

		.red{
			color:red;
		}
	</style>
	<script>
		TestName = "sampleTest1"
		var th = $("#test").height();
		$("#test").hide();
		$("#imageAnswer").hide();
		$("#panel").height(th);
		$("#chart_div").hide();
		var ansarray = new Array();
		var levelarray = new Array();
		var ansstat = new Array();
		//checkTest();
		function checkTest(){
			var obj = {};
			obj.testName = "sampleTest1";
			obj.sid = "6";
			obj.ans = ["option3","option1","option1","option4"]

			var json = JSON.stringify(obj);
			alert(json)
			$.post('saveResponse/', { response:json }, function(result) {
				alert(result);
			});
		}

		$.post('getData/', { getTest:"yes", allTest:"Yes"}, function(result) {
			//alert(result);
    		var jsonData = JSON.parse(result);
			s = "";
			for (var i = 0; i < jsonData.length; i++) {
    			//	console.log(counter.counter_name);
				s = s + '<button type="button" class="list-group-item" name="'+jsonData[i].name+'" onclick="testClicked(this)">'+ jsonData[i].name +' <span class="badge">'+jsonData[i].no +'</span></button>';
				//alert(jsonData[i].name);
			}
			$("#listTest").html(s);
		});

		function testClicked(a) {
			TestName = a.getAttribute("name");

			$.post('getData/', { testName:TestName }, function(result) { // get correct Answers
				//alert(result);
				var a = JSON.parse(result);
				for (i in a){
					ansarray[i] = a[i].ans;
					levelarray[i] = a[i].level;
					ansstat[i] = [0,0,0,0,0];
				}
				//console.log(ansstat);
				$.post('showResult/',{testName:TestName}, function(result) { // get ans of stud

						//alert(result);
						processJsonAns(result);
						showStatus();
				});
			});

		}
		function processJsonAns(json){
			obj = JSON.parse(json);

			s = "";
			h = getAnsTableHead();

			for (i in obj) {									//display student answers
				s = s + "<tr> <td> "+ obj[i].sid + "</td>";
				count = 0;
				arrl =	ansarray.length;
				ansl =  obj[i].ans.length
				if (arrl != ansl){
					alert("not equal");
					if (arrl > ansl){
						for (k = ansl; k <arrl;k++ )
							obj[i].ans[k] = "N/A";
					}else{
						for (k = arrl; k <ansl;k++ )
							ansarray[k] = "N/A";
					}
					h = getAnsTableHead();
				}

				for (j in obj[i].ans) {

					color = "red";
					ansstat[j][getOptionNum(obj[i].ans[j])]++;
					if (ansarray[j] == obj[i].ans[j]){
						color = "green";
						count++;
					}
					s = s + "<td class="+color+"> " + obj[i].ans[j] +"</td>";
				}
				s = s + "<td> " + count +"</td></tr>";
			}
			$("#tresult").html(h + s);
		}
		function getAnsTableHead(){

			s1 = "<thead><tr><td>sid\\ans</td>";					//display crct Answers
			for (i in ansarray){
				s1 = s1 + "<td>"+ansarray[i]+"</td>";
			}
			s1 = s1 + "<td>Correct Answers</td></tr></thead>";

			return s1;
		}
		//alert(getOptionNum("option"));
		function getOptionNum(option){
			if (option.length == 7){
				a = option.charAt(6);
				if (Number(a) != NaN ){
					return Number(a);
				}
			}
			return 0;
		}

		function chartViewOn(){
			$('#chart_div').show();
			$('tresult').hide();
		}
		function showStatus(){
			chartData = [];
			chartData.push(['questionumber','option1','option2','option3','option4']);
			s = "<table>";
			for(i in ansstat){
				qno = Number(i)+1;
				s = s + "<tr><td>"+qno+"</td><td>"+ansstat[i][1]+"</td><td>"+ansstat[i][2]+"</td><td>"+ansstat[i][3]+"</td><td>"+ansstat[i][4]+"</td></tr>";
				chartData.push([qno+'('+ansarray[qno-1]+')',ansstat[i][1],ansstat[i][2],ansstat[i][3],ansstat[i][4]]);
			}
			s = s + "</table>"
			//$("#status").html(s);
			chart(chartData);
		}
		function chart(chartData){
			google.charts.load('current', {'packages':['corechart']});
			google.charts.setOnLoadCallback(drawVisualization);


			function drawVisualization() {
				//console.log(chartData[0]);
			// Some raw data (not necessarily accurate)
				var data = google.visualization.arrayToDataTable(chartData);
				//['question number','option1','option2','option3','option4']

				var options = {
					title : 'Answer Stats',
					vAxis: {title: 'Number of students'},
					hAxis: {title: 'question number'},
					seriesType: 'bars',
					series: {5: {type: 'line'}}
    			};

				var chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
				chart.draw(data, options);
			}
		}
	</script>

</html>
